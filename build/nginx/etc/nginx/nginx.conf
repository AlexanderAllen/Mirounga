# FROM nginx:1.17-alpine
# /etc/nginx cat nginx.conf

# Running as user nobody or non-root user.
# user  nginx;

load_module modules/ngx_http_js_module.so;

worker_processes  auto;

# https://nginx.org/en/docs/ngx_core_module.html#error_log
error_log  stderr info;
pid        /var/run/nginx/nginx.pid;

# Declare where the mounted docroot is at.
# Env var is fed by docker compose.
env PROJECT_DEST;

events {
    worker_connections  1024;
}

http {
    js_include http.js;

    js_set $foo foo;

    # js_set $location getLocation;

    include       /etc/nginx/mime.types;
    default_type  application/octet-stream;

    log_format  main  'Main log: $remote_addr - $remote_user [$time_local] "$request" '
                      '$status $body_bytes_sent "$http_referer" '
                      '"$http_user_agent" "$http_x_forwarded_for"';

    log_format docker 'Docker log:
document_root: $document_root
fastcgi_script_name: $fastcgi_script_name
<domaincapture>: $domaincapture
';

    access_log  /dev/stdout main;

    sendfile        on;
    #tcp_nopush     on;

    keepalive_timeout  65;

    #gzip  on;

    include /etc/nginx/conf.d/*.conf;
}
