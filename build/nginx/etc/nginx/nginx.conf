# FROM nginx:1.17-alpine
# /etc/nginx cat nginx.conf

# https://nginx.org/en/docs/http/ngx_http_js_module.html
# load_module /usr/lib/nginx/modules/ngx_http_js_module.so;

# Performance directives, not allowed in vhosts.
# The default number of workser is 1, we can do more.
# http://nginx.org/en/docs/ngx_core_module.html#worker_processes

# worker_processes  auto;
worker_processes 3;


# https://nginx.org/en/docs/ngx_core_module.html#error_log
error_log  stderr info;
pid        /var/run/nginx/nginx.pid;

# Tell Nginx to preserve these environment variables:
env PROJECT_DEST;

events {
    worker_connections  1024;
}

http {
    large_client_header_buffers 4 8k;
    ignore_invalid_headers off;

    # js_import /etc/nginx/http.js;
    # js_set $projectRoot http.projectDestination;

    # include       /etc/nginx/mime.types;
    # default_type  application/octet-stream;

    # Define default log format.
    log_format  main  '[main] $remote_addr - $remote_user [$time_local] "$request" '
                      '$status $body_bytes_sent "$http_referer" '
                      '"$http_user_agent" "$http_x_forwarded_for"';

    # Supplemental log format for static assets and paths.
    log_format supplemental '[supplemental] HTTP $status - $time_local - "$request" ';

    # Define log format for PHP-FPM requests.
    log_format docker '[Docker]
Local Time: $time_local
Remote Addr: $remote_addr
Request: "$request"
URI: $uri
Query String: $query_string
Status: $status
Document Root: $document_root
Request Time: $request_time
realpath_root: $realpath_root
Host: $host
Server Name: $server_name
';

    # Specify default log format to use.
    access_log  /dev/stdout main;

    # sendfile        on;
    # keepalive_timeout  65;

    # Virtual host configuration.
    include /etc/nginx/conf.d/*.conf;
}
