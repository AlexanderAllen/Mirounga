version: '2'
services:

  # To copy the contents of /composer to the host for debugging, use docker cp.
  # http://stackoverflow.com/a/36246479
  # Example:
  #   docker-compose -f php-cli.yml run drush-7
  #   exit
  #   docker ps -a | head
  #   docker cp localenv_drush-7_run_5:/composer ~/.composer
  # or, if you have a host mount at like ~/.composer:/composer_host
  #   docker-compose -f php-cli.yml run drush-7
  #   rm -rf /composer_host/*
  #   cp -rvf /composer/* /composer_host

  # Just runs composer require drush on top of php-cli image.
  # Also makes drush the entrypoint.
  drush-7:
    image: alexanderallen/drush:7.x
    build:
      context: .
      args:
        DRUSH_VERSION: 7.4.0
        COMPOSER_GLOBAL: 1
    volumes:
      - ~/.drush:/root/.drush

      # To copy the build results from the image to the host, mount this volume.
      # - ~/.composer:/composer_host
      # To mount the local composer install into the container, mount this volume.
      - ~/.composer:/composer

  drush-8:
    image: alexanderallen/drush:8.x
    build:
      context: .
      args:
        DRUSH_VERSION: 8.1.5
        DRUSH_ALIAS: drush8
    volumes:
      - ~/.drush:/root/.drush
      - ~/Sites:/www
