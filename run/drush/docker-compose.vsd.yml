version: '3.7'

networks:
  default:
    external: true
    name: ${COMPOSE_NETWORK:-localenv}
  VSD:
    external: true

# You need to be on 3.x or greater to use secrets.
# They're not available on 2.x.
# secrets:
#   ssh_private:
#     file: /c/Users/richa/.ssh/id_rsa
#   ssh_public:
#     file: /c/Users/richa/.ssh/id_rsa.pub

services:

  drush:
    # Without xdebug.
    # image: alexanderallen/php7-cli.drush9:alpine-3.11
    # With xdebug and tools.
    image: alexanderallen/php7-cli-drush9.dev:alpine-3.11
    # secrets:
    #   - ssh_private
    #   - ssh_public
    environment:
      XDEBUG_SHOW_EXCEPTION_TRACE: 0

      # Share the socket variable as well.
      SSH_AUTH_SOCK: $SSH_AUTH_SOCK

    # Mount to same source destination as PHP-FPM and Nginx.
    working_dir: /vsdroot

    volumes:

      # WSL2 to DD bind, performant.
      # $USER variable assumes compose run within WSL and not WIN10.
      # - type: bind
      #   # Bind from WSL.user to continer.
      #   source: "/home/${USER}/Workloads"
      #   # Nobody doesn't have a home in alpine.
      #   target: /home/nobody/Workloads
      #   consistency: consistent

      - "${PROJECT_SOURCE}:${PROJECT_DEST}"

      # Share the SSH socket file.
      - ${SSH_AUTH_SOCK}:${SSH_AUTH_SOCK}
